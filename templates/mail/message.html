{% extends 'base.html' %}

{% block title %} ПОЧТА | СООБЩЕНИЕ | ОТВЕТИТЬ {% endblock %}

{% block scripts %}<script src="/static/mail/js/add_file.js?r=1"></script>{% endblock %}

{% block content %}
<div class="message-container w3-margin-top w3-padding w3-white">
    <div class="w3-margin-bottom" style="display: flex; justify-content: flex-end;"><!-- justify-content: flex-end -->
        {% for user in users %}
            {% if message.sender == user.id and message.sender != us._id %}
            <span class="w3-text-brown glyphicon glyphicon-copy" style="cursor: pointer" onclick="getQuote('{{ message.id }}_text', '{{ user.name }}', `{{ message.date.strftime('%H:%M (%d.%m.%Y)') }}`)"></span>
            {% endif %}
        {% endfor %}
        {% if message.sender == us._id %}
        <strong>
            <a href="/mail/remove/{{message.id }}"><small><span class="w3-text-brown glyphicon glyphicon-trash"></span></small></a>
        </strong>
        {% endif %}
    </div>
    <div id="{{ message.id }}_text" class="message">{{ message.text }}</div>
    {% if message.file_name %}
        {% if message.file_type in image %}
            <div class="w3-margin-top w3-center">
                <a href="/mail/message/file/{{ message.id }}">
                    <img src="/mail/message/file/{{ message.id }}" width="100%" style="width: 100%; max-width: 420px"/>
                </a>
            </div>
        {% elif message.file_type in audio %}
            <audio src="/mail/message/file/{{ message.id }}" controls style="margin: 8px 0 0 0; width:100%"></audio>
		{% elif message.file_type in video %}
			<div class="w3-margin-top w3-center"><video src="/mail/message/file/{{ message.id }}" controls style="width: 100%; max-width: 420px"></video></div>
        {% endif %}
        <div class="w3-margin-top w3-center" style="word-wrap: break-word;">
            <small>{{ message.file_type }}<br>{{ message.file_size }} байт<br><a class="w3-hover-text-blue" href="/mail/message/file/{{message.id }}" download="{{ message.file_name }}">{{ message.file_name }}</a></small>
        </div>
    {% endif %}
    <div class="w3-margin-top" style="display: flex; justify-content: space-between">
        <div>
        {% for user in users %}
            {% if message.sender == user.id %}
            <strong class="w3-text-brown"><small>{{ user.name }}</small></strong> > 
            {% endif %}
        {% endfor %}
        {% for user in users %}
            {% if message.recipient == user.id %}
            <strong class="w3-text-brown"><small>{{ user.name }}</small></strong>
            {% endif %}
        {% endfor %}
        </div>
        <strong class="w3-text-brown" style="line-height: 2.2; font-size: 10px">{{ message.date.strftime('%H:%M (%d.%m.%Y)') }}</strong>
    </div>
</div>
{% if message.sender != us._id %}
<form id="add_comment" class="w3-padding" action="/mail/add" enctype="multipart/form-data" method="POST">
    <select name="recipient" class="w3-margin-bottom w3-input w3-white" style="width: 200px" required>
    {% for user in users %}
        {% if message.sender == user.id %}
        <option value="{{ user.id }}">{{ user.name }}</option>
        {% endif %}
    {% endfor %}
    </select>
    <p><input class="w3-check w3-white" type="checkbox" name="title" checked="checked"> получить титл</p>
    <p><input class="w3-check w3-white" type="checkbox" name="code"> отправить код (титлы отключить)</p>
    <p id="quote_info" class="w3-center w3-text-indigo"></p>
    <p id="info" class="w3-center w3-text-indigo"></p>
    <input id="quote" type="hidden" name="quote" />
    <textarea id="text" name="text" class="w3-input w3-white" style="resize: vertical" rows="7" placeholder="текст сообщения"></textarea>
    <input id="file" style="display: none;" type="file" name="file" accept="" />
    <input id="file_size" type="hidden" name="file_size" />
    <button class="w3-margin-top w3-button w3-tiny w3-teal text-bold" onclick="send(event)">ОТПРАВИТЬ</button>
    <button class="w3-margin-top w3-right w3-button w3-tiny w3-teal text-bold" onclick="addFile(event, 'file')">ФАЙЛ</button>
</form>
{% endif %}
{% endblock %}
